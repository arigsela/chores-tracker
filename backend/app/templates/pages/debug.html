{% extends "layouts/base.html" %}

{% block title %}Debug Info - Chores Tracker{% endblock %}

{% block content %}
<div class="bg-white rounded-lg shadow-md p-6">
    <h2 class="text-2xl font-bold mb-4">Debug Information</h2>
    
    <div class="space-y-4">
        <div class="border rounded p-4">
            <h3 class="font-semibold mb-2">Browser Info</h3>
            <pre id="browser-info" class="bg-gray-100 p-2 rounded text-sm"></pre>
        </div>
        
        <div class="border rounded p-4">
            <h3 class="font-semibold mb-2">JavaScript Support</h3>
            <pre id="js-support" class="bg-gray-100 p-2 rounded text-sm"></pre>
        </div>
        
        <div class="border rounded p-4">
            <h3 class="font-semibold mb-2">Storage Test</h3>
            <pre id="storage-test" class="bg-gray-100 p-2 rounded text-sm"></pre>
        </div>
        
        <div class="border rounded p-4">
            <h3 class="font-semibold mb-2">Fetch API Test</h3>
            <pre id="fetch-test" class="bg-gray-100 p-2 rounded text-sm"></pre>
        </div>
        
        <div class="border rounded p-4">
            <h3 class="font-semibold mb-2">HTMX Test</h3>
            <div id="htmx-test" hx-get="/api/v1/healthcheck" hx-trigger="load">
                <p class="text-gray-500">Testing HTMX...</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Browser info
    document.getElementById('browser-info').textContent = JSON.stringify({
        userAgent: navigator.userAgent,
        platform: navigator.platform,
        language: navigator.language,
        cookieEnabled: navigator.cookieEnabled,
        onLine: navigator.onLine,
        screenWidth: screen.width,
        screenHeight: screen.height
    }, null, 2);
    
    // JavaScript support tests
    const jsTests = {
        es6Arrow: false,
        promises: false,
        fetch: false,
        localStorage: false,
        sessionStorage: false,
        classList: false
    };
    
    try {
        eval('() => {}');
        jsTests.es6Arrow = true;
    } catch(e) {}
    
    jsTests.promises = typeof Promise !== 'undefined';
    jsTests.fetch = typeof fetch !== 'undefined';
    jsTests.localStorage = typeof localStorage !== 'undefined';
    jsTests.sessionStorage = typeof sessionStorage !== 'undefined';
    jsTests.classList = document.body.classList !== undefined;
    
    document.getElementById('js-support').textContent = JSON.stringify(jsTests, null, 2);
    
    // Storage test
    const storageTest = {
        localStorageWorks: false,
        sessionStorageWorks: false,
        tokenExists: false,
        error: null
    };
    
    try {
        localStorage.setItem('test', 'test');
        localStorage.removeItem('test');
        storageTest.localStorageWorks = true;
        storageTest.tokenExists = !!localStorage.getItem('token');
    } catch(e) {
        storageTest.error = e.toString();
    }
    
    try {
        sessionStorage.setItem('test', 'test');
        sessionStorage.removeItem('test');
        storageTest.sessionStorageWorks = true;
    } catch(e) {}
    
    document.getElementById('storage-test').textContent = JSON.stringify(storageTest, null, 2);
    
    // Fetch test
    if (typeof fetch !== 'undefined') {
        fetch('/api/v1/healthcheck')
            .then(response => {
                document.getElementById('fetch-test').textContent = JSON.stringify({
                    fetchWorks: true,
                    status: response.status,
                    ok: response.ok,
                    headers: Object.fromEntries(response.headers.entries())
                }, null, 2);
                return response.json();
            })
            .then(data => {
                const current = JSON.parse(document.getElementById('fetch-test').textContent);
                current.data = data;
                document.getElementById('fetch-test').textContent = JSON.stringify(current, null, 2);
            })
            .catch(error => {
                document.getElementById('fetch-test').textContent = JSON.stringify({
                    fetchWorks: false,
                    error: error.toString()
                }, null, 2);
            });
    } else {
        document.getElementById('fetch-test').textContent = 'Fetch API not supported';
    }
    
    // HTMX event listeners
    document.addEventListener('htmx:afterSwap', function(event) {
        if (event.detail.target.id === 'htmx-test') {
            event.detail.target.innerHTML = '<p class="text-green-600">HTMX works! Response: ' + event.detail.xhr.responseText + '</p>';
        }
    });
    
    document.addEventListener('htmx:responseError', function(event) {
        if (event.detail.target.id === 'htmx-test') {
            event.detail.target.innerHTML = '<p class="text-red-600">HTMX error: ' + event.detail.xhr.status + '</p>';
        }
    });
</script>
{% endblock %}